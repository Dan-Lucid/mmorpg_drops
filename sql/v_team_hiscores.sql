CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_team_hiscores` AS select dense_rank() OVER (ORDER BY sum(`playerscores`.`PlayerPoints`) desc )  AS `Ranking`,`teams`.`TeamName` AS `TeamName`,coalesce(sum(`playerscores`.`PlayerPoints`),0) AS `Points` from (`teams` left join (select distinct `players`.`TeamID` AS `teamID`,coalesce(sum((`items`.`PointValue` * count(`records`.`ItemID`))) OVER (PARTITION BY `records`.`PlayerID` ) ,0) AS `PlayerPoints` from ((`players` left join `records` on((`players`.`PlayerID` = `records`.`PlayerID`))) left join `items` on((`records`.`ItemID` = `items`.`ItemID`))) group by `players`.`PlayerID`,`records`.`ItemID` order by `PlayerPoints` desc) `playerscores` on((`teams`.`TeamID` = `playerscores`.`teamID`))) group by `teams`.`TeamName`;
