CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `v_team_hiscores` AS select dense_rank() OVER (ORDER BY sum(`playercores`.`PlayerPoints`) desc )  AS `Ranking`,`team`.`TeamName` AS `TeamName`,coalesce(sum(`playercores`.`PlayerPoints`),0) AS `Points` from (`team` left join (select distinct `player`.`TeamID` AS `teamID`,coalesce(sum((`item`.`PointValue` * count(`record`.`ItemID`))) OVER (PARTITION BY `record`.`PlayerID` ) ,0) AS `PlayerPoints` from ((`player` left join `record` on((`player`.`PlayerID` = `record`.`PlayerID`))) left join `item` on((`record`.`ItemID` = `item`.`ItemID`))) group by `player`.`PlayerID`,`record`.`ItemID` order by `PlayerPoints` desc) `playercores` on((`team`.`TeamID` = `playercores`.`teamID`))) group by `team`.`TeamName`;
